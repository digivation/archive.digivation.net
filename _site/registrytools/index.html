<p><strong>Description</strong>: This JScript library** provides several functions that allow scripts to interface with the <a href="http://msdn2.microsoft.com/en-us/library/aa393664(VS.85).aspx">WMI Registry provider</a> on local or remote machines. The library is intended to be run on/against Windows machines through the <a href="http://en.wikipedia.org/wiki/Windows_Script_Host">Windows Scripting Host</a>. This reduces redundant code and makes the WMI registry functions as simple to use as the WSH registry functions.</p>

<p><strong>Computer and Hive Arguments</strong></p>

<p>All functions require <em>computer</em> and <em>hive</em> arguments. <em>Computer</em> should be a string containing an IP address or computer host name of the computer you wish to operate upon. If you are working with the local machine, use “.” for the <em>computer</em> argument. <em>Hive</em> is a string that determines which root hive you wish to connect to. The options are listed below (ie if you wish to retrieve a key under HKEY_CURRENT_USER, you would pass HKCU to the function).</p>

<h1 id="hive_argument">hive argument</h1>

<p>HKEY_CLASSES_ROOT HKCR HKEY_CURRENT_USER HKCU HKEY_LOCAL_MACHINE HKLM HKEY_USERS HKU</p>

<h1 id="hkey_current_config_hkcc">HKEY_CURRENT_CONFIG HKCC</h1>

<p><strong>Functions</strong>:</p>

<ul>
<li>
<p>registryToolsEnumValues(computer, hive, key)</p>

<ul>
<li>This function gets a list of all the values under a given key in the registry and returns an array of values and associated data types.</li>

<li>Takes three inputs:
<ul>
<li><em>computer</em> – see above</li>

<li><em>hive</em> – see above</li>

<li><em>key</em> – a string containing the name of the key you wish to enumerate (list the values of)</li>
</ul>
</li>

<li>Returns an object containing two arrays:
<ul>
<li><em>values</em> – an array containing the string names of each value</li>

<li><em>types</em> – an array containing a string denoting the data type of each value (REG_SZ, REG_BINARY, REG_DWORD, REG_EXPAND_SZ, REG_MULTI_SZ)</li>

<li>these arrays are related by index (ie values[0] types[0])</li>
</ul>
</li>
</ul>
</li>

<li>
<p>registryToolsReadValue(computer, hive, key, value, type)</p>

<ul>
<li>Reads the data in a given value in the registry</li>

<li>Takes five inputs:
<ul>
<li><em>computer, hive</em> – see above</li>

<li><em>key</em> – a string containing the name of the key containing the value you want to read</li>

<li><em>value</em> – the name of the value who’s data you want to read</li>

<li><em>type</em> – the data type of the value (can be found using <em>registryToolsReadValue</em> or looking in the registry). Should be one of the following strings: REG_SZ, REG_BINARY, REG_DWORD, REG_EXPAND_SZ, REG_MULTI_SZ</li>
</ul>
</li>

<li>Returns the data contained in the value. Data type depends on the type of the requested value, according to the following table: type returns</li>
</ul>
</li>
</ul>

<p>=========================== REG_BINARY int REG_DWORD int REG_EXPAND_SZ string REG_MULTI_SZ string array</p>

<h1 id="reg_sz_string">REG_SZ string</h1>

<ul>
<li>
<p>registryToolsWriteValue(computer, hive, key, value, type, data)</p>

<ul>
<li>Writes the given data to the given registry key/value</li>

<li>Takes six inputs:
<ul>
<li><em>computer, hive</em> – see above</li>

<li><em>key</em> – the key containing the value you want to write to</li>

<li><em>value</em> – the name of the value who’s data you wish to set</li>

<li><em>type</em> – the type of data you wish to write: type input data type</li>
</ul>
</li>
</ul>
</li>
</ul>

<p>================================================== REG_BINARY array of ints REG_DWORD hex or decimal number (int) REG_EXPAND_SZ string REG_MULTI_SZ array of strings</p>

<h1 id="reg_sz_string_2">REG_SZ string</h1>

<pre><code>    *   *data* &amp;#8211; this argument should contain the data you wish written into the value, in the type specified
*   Outputs: 
    *   none (currently, later revisions may return an error code if applicable)</code></pre>

<ul>
<li>
<p>registryToolsDeleteValue(computer, hive, key, value)</p>

<ul>
<li>Removes the specified value from the given registry key</li>

<li>Inputs:
<ul>
<li><em>computer, hive</em> – see above</li>

<li><em>key</em> – string containing the key containing the value you wish to delete</li>

<li><em>value</em> – string containing the name of the value to be deleted</li>
</ul>
</li>

<li>Outputs:
<ul>
<li>none currently</li>
</ul>
</li>
</ul>
</li>

<li>
<p>registryToolsEnumKeys(computer, hive, key)</p>

<ul>
<li>Lists the sub-keys of the given key</li>

<li>Inputs:
<ul>
<li><em>computer, hive</em> – see above</li>

<li><em>key</em> – string containing the name of the key to be enumerated</li>
</ul>
</li>

<li>Outputs:
<ul>
<li>an array of strings containing the names of the sub-keys</li>
</ul>
</li>
</ul>
</li>

<li>
<p>registryToolsCreateKey(computer, hive, key)</p>

<ul>
<li>Creates a new key</li>

<li>Inputs:
<ul>
<li><em>computer, hive</em> – see above</li>

<li><em>key</em> – the name of the key to be created (you can use “key//subkey//subkey2″ to nest keys)</li>
</ul>
</li>

<li>Outputs:
<ul>
<li>none for now</li>
</ul>
</li>
</ul>
</li>

<li>
<p>registryToolsDeleteKey(computer, hive, key)</p>

<ul>
<li>Removes given key (and all sub-values) from registry, but only if there are no sub-keys</li>

<li>Inputs:
<ul>
<li><em>computer, hive</em> – see above</li>

<li><em>key</em> – the name of the key to be removed</li>
</ul>
</li>

<li>Outputs:
<ul>
<li>none currently</li>
</ul>
</li>
</ul>
</li>
</ul>

<p><strong>Note on “JS Library”</strong>: Since WSH and JScript do not normally support the inclusion of external code into a script, a handy workaround is found various places on the internet. I don’t take credit for this code!</p>

<p>In the script that you wish to make calls from, you must have two things: the <em>include</em> function (only needed once), and an <em>eval</em> call (which you use for each external file you wish to include). You can place the <em>include()</em> function anywhere in your script, but be sure that your <em>eval</em> statement occurs before the first time that you try to call an external function.</p>

<p><strong>The Include() Function</strong><br />function include(fileName) {<br />var fso = new ActiveXObject(“Scripting.FileSystemObject”); // create the file system object<br />if( !fso.FileExists(fileName) ) { return -1; } // check for file existance and fail if no file<br />var file = fso.OpenTextFile(fileName);<br />var stream = file.ReadAll();<br />file.Close();<br />return stream;<br />}</p>

<p><strong>The Eval() Call</strong><br />eval( include(“wmiRegistryTools.js”) );</p>

<p><strong>References</strong></p>

<p>I referred to the following pages while writing this script. There are probably even more pages that I found useful but who’s links I have forgotten.</p>

<ul>
<li><a href="http://msdn2.microsoft.com/en-us/library/aa393664(VS.85).aspx">The MSDN Reference for StdRegProv</a></li>

<li><a href="http://jscriptman.blogspot.com/2006/03/installed-software-on-pc-via-wmi.html">Script Man’s (Tom Medhurst) Page on WMI Software Installation</a> (hugely helpful in figuring out how to interact with StdRegProv using JScript!)</li>
</ul>